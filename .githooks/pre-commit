#!/bin/bash

touch .commit

sha="$(git ls-files -s packages/addons.xml | awk '{print $2}')"
prefix='<!-- DO NOT EDIT. -->
<!-- Generated by git commit hooks. -->
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<addons>'
suffix='</addons>'
addon=$(tail -n +2 addon.xml)

printf "$prefix\n$addon\n$suffix\n" > packages/addons.xml
cat packages/addons.xml | shasum | awk '{print $1}' > packages/addons.xml.crc
truncate --size -1 packages/addons.xml.crc

python ./scripts/update_changelog.py

exit
